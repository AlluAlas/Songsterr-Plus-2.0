import{g as e,y as t,s,l as n,d as r,e as i}from"./preact.89f2d999.js";import{u as o,bt as a,bu as l,bv as c,bw as u,bx as d,by as g,bz as m,bA as f,bB as p,E as h,y as b,Y as S,bC as v}from"./index.0e02c5ee.js";import{u as y,s as F,S as I,a as j,b as x,I as w,R as N}from"./SongsPanel.a5dde152.js";import{S as P}from"./SongsItem.0ded978c.js";import{S as k}from"./SearchBox.599c4e55.js";import{S as C}from"./Stub.619b21c6.js";import{P as T}from"./Panel.3ed0232a.js";import"./ShowroomPlaceholder.48ae4617.js";import"./DifficultyIndicator.6b73f35d.js";const A="IntersectionObserver"in window,D=e((e=>{let{route:D,user:B,device:E,isSmallScreen:M,id:O}=e;const{dispatch:R,songs:z,meta:L}=o("songs","meta");t((()=>a({route:D,songs:z,device:E})),[z.pattern,z.filters]);const V=s(),W=s();y(V,W,"SongsPanel");const{isDesktop:Y}=E,{hasPlus:q}=B,G=z.songs.pattern.length>0,H=l(z.filters,""),J=""!==H?" ".concat(H):"",K=z.pattern.length?"Search".concat(J," Tabs"):"Popular".concat(J," Tabs"),[Q,U]=n(z.pattern),X=s(),Z=r((()=>e=>{clearTimeout(X.current),U(e);const t=e.replace(/\s+/g," ").trim();c(t);const s=()=>R("songs/filter/pattern",t);""===t?s():X.current=setTimeout(s,500)}),[U]),$=()=>{p(v),R("songs/filter/reset")},[_,ee]=n(null),te=z.songs.list||[],se=0===z.pattern.length&&0===te.length,ne=u(z.filters.instrument),re=u(z.songs.filters.instrument),ie=0===z.pattern.length?{}:{pattern:z.pattern},oe=d.map((e=>g("/",e,ie))),ae=m(z.songs.filters),le=z.songs.hasMore&&!se,ce=s();t((()=>{try{if(ce.current&&A){const e=new IntersectionObserver((e=>{e[0].isIntersecting&&R("songs/more")}),{rootMargin:"0px 0px 300px 0px",threshold:1,root:document.getElementById("panel-search")});return e.observe(ce.current),()=>e.disconnect()}}catch(e){console.error(e)}}),[]);const ue={tuningFilter:z.filters.tunings[z.filters.instrument]||f,instrumentFilter:z.filters.instrument,difficultyFilter:z.filters.difficulty,setTuningFilter:e=>R("songs/filter/tuning",{instrument:z.filters.instrument,tuning:e}),setInstrumentFilter:e=>{p(e),R("songs/filter/instrument",e)},setDifficultyFilter:e=>R("songs/filter/difficulty",e),difficultyFilterNA:ne,spacerSize:G?"normal":"big",numberSpacer:!G,isSmallScreen:M,instrumentSEOLinks:oe,activeFilter:_,onFilterClick:e=>ee(e===_?null:e)};return i(T,{title:K,id:O,styles:F,onClick:()=>ee(null),children:[i(I,{children:[i(k,{value:Q,setValue:Z,isDesktop:Y,loading:!!z.loading,inputRef:W,placeholder:"Search over 500,000 tabs"}),i(j,ue),Y&&!q&&i(x,{page:D.page,instrumentFilter:z.filters.instrument})]}),!se&&te.length>0&&i("div",{className:F.songs,"data-list":"songs",ref:V,children:te.map((e=>i(P,{song:e,isActive:L&&L.songId===e.songId,numerated:!G,difficultyNA:re},e.songId.toString())))}),!A&&z.songs.hasMore&&i("div",{className:F.button,children:i(h,{onClick:()=>R("songs/more"),title:"Show more",processing:!!z.loading})}),A&&i("div",{ref:ce,children:[le&&!!z.loading&&i(b,{fill:"#777",width:35,height:35,className:S.songs})]}),!se&&0===te.length&&i("div",{className:F.stubWrapper,children:[i(C,{id:"notfound",header:"No tabs found",headerColor:"red",icon:()=>i(w,{}),children:i(N,{usesFilters:ae,numResults:0,resetFilter:ae?$:()=>{$(),Z("")}})})]})]})}));export{D as default};
//# sourceMappingURL=SongsPanel.e86def1f.js.map
