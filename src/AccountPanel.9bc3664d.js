import{l as a,A as e,v as t,_ as i,i as s}from"./preact.89f2d999.js";import{u as n,c6 as o,E as r,H as c,z as d,a7 as l,aa as m,L as u,c7 as p,n as h,K as g,bX as C,bY as f,c8 as v,F as N}from"./index.0e02c5ee.js";import{a as y,s as P,n as b}from"./Section.fdb522b8.js";import{e as S,f as k}from"./user.151b6a3c.js";import{b as A}from"./google.7600d979.js";import{P as _}from"./Panel.3ed0232a.js";var w={actions:y+" Bg42w6"};function X(){const{dispatch:i}=n(),[s,d]=a(!1),[l,m]=a(null),u=e((async a=>{m(null),d(!0),a.preventDefault();try{i("user/profile",await o()),i("curiosity/conversion",{event:"Activated android promo"})}catch(a){m(a),i("curiosity/error",{error:"Android Promo",message:a.message})}d(!1)}),[]);return t("form",{noValidate:!0,onSubmit:u,action:""},t(c,{error:l}),t("div",{className:w.actions},t(r,{id:"startAndroidPromo",title:"Start free trial",processing:s})))}var E={section:P+" C2d1r2",sectionAccount:P+" C2d1r2 C2d7m",sectionProfile:P+" C2d1r2 C2dm0",sectionUpdateCard:P+" C2d1r2 C2d2sf",sectionPrivacy:P+" C2d1r2 C2d2gw",sectionSignout:P+" C2dnj",actions:y+" C2d1zt",field:d+" C2d20d",hint:l+" C2d1ok",link:"C2d1q5",fieldCard:d+" C2d20d C2d2fm",miniCard:"C2d2q6",miniCardInner:"C2d1ue",miniCardNumber:"C2d1r5",miniCardBtn:"C2d12k",noticeTitle:"C2d1g5",notice:b+" C2d2g5",noticeAndroid:b+" C2d2g5 C2d1x6",noticeCancellation:b+" C2d2g5 C2d1e5"},x={badge:"Cnodm",badgePlus:"Cnodm Cno1h8",badgePlusExtended:"Cnodm Cno9s",badgeFree:"Cnodm Cno2i7",badgeAndroidLifetime:"Cnodm Cnotc",header:"Cnoj4",secondary:"Cno1fv",primary:"Cnooj",footer:"Cnort",icon:"Cno31l",text:"Cno2ru",button:m+" Cnold"};function L(a){let{onClick:e}=a;return t("div",{className:x.badgeFree},t("div",{className:x.header},t("img",{src:"/static/media/devices.a3e3d850.svg",className:x.icon,width:149,height:66}),t("div",{className:x.text,id:"account-type"},t("span",{className:x.secondary},"ACCOUNT TYPE"),t("span",{className:x.primary},"FREE"))),t("div",{className:x.footer,id:"account-meta"},t(u,{to:"/a/wa/plus",className:x.button,onClick:e},"Upgrade to PLUS")))}function U(a){let{isCanceled:e,isMonthTrial:i}=a;const s=e||i;return t("div",{className:s?x.badgePlusExtended:x.badgePlus},t("div",{className:x.header},t("div",{className:x.header},t("img",{src:"/static/media/plus.57c4d40a.svg",className:x.icon,width:144,height:73}),t("div",{className:x.text,id:"account-type"},t("span",{className:x.secondary},"ACCOUNT TYPE"),t("span",{className:x.primary},"PLUS"))),s&&t("div",{className:x.footer,id:"account-meta"},e&&t("span",null,t("strong",null,"Canceled.")," Active till the end of the last paid month."),!e&&i&&t("span",null,"This is a one month free trial."))))}function T(){const{experiments:a}=n("experiments");return t("div",{className:x.badgeAndroidLifetime},t("div",{className:x.header},t("img",{src:"/static/media/android.181a8323.svg",className:x.icon,width:86,height:65}),t("div",{className:x.text,id:"account-type"},t("span",{className:x.secondary},"ACCOUNT TYPE"),t("span",{className:x.primary},"Android"),t("span",{className:x.primary},"Lifetime"))),t("div",{className:x.footer,id:"account-meta"},t("span",null,"You have all the features unlocked for the ",t("a",{href:p("android",a,"android_lifetime")},"Songsterr Android")," app.")))}class j extends i{__init(){this.name=s()}__init2(){this.email=s()}constructor(a){super(a),j.prototype.__init.call(this),j.prototype.__init2.call(this),j.prototype.__init3.call(this),j.prototype.__init4.call(this),j.prototype.__init5.call(this),this.state={error:null,processing:!1,signoutError:null,signoutProcessing:!1}}__init3(){this.onUpgradeClick=()=>{this.props.dispatch("curiosity/setConversionProps",{"Last referring link":"AccountPanel Upgrade Link"})}}__init4(){this.handleSignOut=async a=>{a.preventDefault();try{this.setState({signoutProcessing:!0,signoutError:null}),await S(),this.props.dispatch("user/signOut"),A(),this.setState({signoutProcessing:!1,signoutError:null}),this.props.dispatch("navigate","/a/wa/signin")}catch(a){this.setState({signoutProcessing:!1,signoutError:a})}}}__init5(){this.handleSave=async a=>{a.preventDefault();const e=this.name.current,t=this.email.current;try{g([{field:e,validator:C},{field:t,validator:f}]),this.setState({processing:!0,error:null});const a=await k(e.value,t.value);this.props.dispatch("user/profile",a),this.setState({processing:!1,error:null})}catch(a){this.setState({processing:!1,error:a})}}}render(){v();const{hasPlus:a,hasSubscription:e,isLoggedIn:i,profile:s}=this.props.user;if(!i)return t(_,{title:"Account",id:"account"},t("div",{className:"Panel-inner"}));const{planCancelDate:n,planEndDate:o,name:d,email:l,isLegacyPayPal:m,isAndroidLifetime:p,plan:h}=s,g=p&&!a?"Android Lifetime":h,C=p&&!a,f=p&&a&&!s.subscription,y=e&&!n,P=a&&o;return t(_,{title:"Account",id:this.props.id},t("div",{className:"Panel-inner"},t("section",{className:E.sectionAccount,"data-section":"update"},t("form",{noValidate:!0,onSubmit:this.handleSave,action:""},t(c,{error:this.state.error}),t(N,{type:"text",label:"Name",ref:this.name,name:"name",defaultValue:d,error:this.state.error,autocomplete:"name"}),t(N,{type:"email",label:"Email",ref:this.email,name:"email",defaultValue:l,error:this.state.error,autocomplete:"email"}),t("div",{className:E.actions},t(r,{title:"Save",processing:this.state.processing}))),t(u,{to:"/a/wa/account/password",className:E.link,"data-link":"password"},"Change password")),t("section",{className:E.sectionProfile,"data-section":"profile"},"Android Lifetime"===g&&t(T,null),"FREE"===g&&t(L,{onClick:this.onUpgradeClick}),"PLUS"===g&&t(U,{isCanceled:P,isMonthTrial:f}),C&&t("div",{className:E.noticeAndroid,id:"account-android-notice"},t(u,{id:"upgradeFromAndroid",to:"/a/wa/plus",onClick:this.onUpgradeClick},"Upgrade to PLUS")," to get all the features across all the platforms, or start a one month free trial.",t(X,null)),y&&t(u,{id:"cancelSubscription",to:"/a/wa/account/subscription",className:E.link,"data-link":"cancel"},"Cancel subscription")),e&&!n&&!m&&t("section",{className:E.sectionUpdateCard,"data-section":"card"},t("div",{className:E.miniCard},t("div",{className:E.miniCardInner},t("div",{className:E.miniCardNumber,"data-value":"card"},"XXXX-XXXX-XXXX-XXXX"),t("div",{className:E.miniCardBtn},t(u,{id:"updateCardLink",to:"/a/wa/account/card","data-link":"card"},"Update card"))))),t("section",{className:E.sectionPrivacy,"data-section":"privacy"},t("p",{className:E.noticeTitle},"EXPORT"),t("p",{className:E.notice,"data-label":"privacy-notice"},"You are in control of the content in your Songsterr account, even if you stop using Songsterr or decide to delete your account altogether."),t("a",{id:"exportPersonalData",className:E.link,target:"_blank",href:"/api/privacy/data","data-link":"export"},"Download my data (JSON)"),!a&&t(u,{to:"/a/wa/account/deactivate",className:E.link,"data-link":"deactivate"},"Deactivate my account")),t("section",{className:E.sectionSignout,"data-section":"signout"},t("form",{noValidate:!0,onSubmit:this.handleSignOut},t(r,{id:"signout",title:"Sign out",processing:this.state.signoutProcessing})))))}}var D=h(j,"user","experiments");export{D as default};
//# sourceMappingURL=AccountPanel.9bc3664d.js.map
